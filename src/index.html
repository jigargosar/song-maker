<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elm + Parcel App</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div id="root"></div>

    <!-- Load piano instrument data from CDN -->
    <script src='https://surikov.github.io/webaudiofontdata/sound/0250_SoundBlasterOld_sf2.js'></script>

    <!-- Load WebAudioFont player from CDN -->
    <script src='https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js'></script>

    <script type="module">
        import { Elm } from "./Main.elm";

        // Capture globals as clean constants
        const WebAudioFontPlayer = window.WebAudioFontPlayer;
        const piano = window._tone_0250_SoundBlasterOld_sf2;

        // Initialize Elm
        const app = Elm.Main.init({ node: document.getElementById("root") });

        // Initialize WebAudioFont
        const audioContext = new AudioContext();
        const player = new WebAudioFontPlayer();

        // Use the captured constants
        player.loader.decodeAfterLoading(audioContext, piano);

        // Listen to Elm port commands
        app.ports.playNote.subscribe((noteData) => {
            const { note, duration, volume } = noteData;
            player.queueWaveTable(audioContext, audioContext.destination,
                piano, 0, note, duration, volume);
        });
    </script>
</body>
</html>

